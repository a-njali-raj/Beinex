{% extends "layout/base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Post Details -->
            <div class="post">
                <h2>{{ post.title }}</h2>
                <p class="text-muted">Posted by {{ post.author.username }} on {{ post.created_at }}</p>
                
                <!-- Post Image -->
                {% if post.image %}
                    <img src="{{ post.image.url }}" alt="{{ post.title }}" class="img-fluid mb-3">
                {% endif %}
                
                <!-- Post Content -->
                <p>{{ post.content }}</p>

                <!-- Post Tags -->
                <p><strong>Tags:</strong> 
                    {% if post.tags.all %}
                        {% for tag in post.tags.all %}
                            <a href="#" class="text-primary">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    {% else %}
                        No tags
                    {% endif %}
                </p>

                <!-- Comments Section -->
                <div class="comments-section mt-4">
                    <h4>Comments</h4>
                    <!-- Display the first comment only -->
                    {% if comments %}
                        <div class="media mb-3 comment-item">
                            {% if comments.0.author.profile_pic %}
                                <!-- Display user profile picture if available -->
                                <img class="mr-3" src="{{ comments.0.author.profile_pic.url }}" alt="{{ comments.0.author.username }}" style="width: 64px; height: 64px; border-radius: 50%;">
                            {% else %}
                                <!-- Display Font Awesome user icon if no profile picture -->
                                <i class="fas fa-user-circle fa-3x mr-3"></i>
                            {% endif %}
                            <div class="media-body">
                                <h5 class="mt-0">{{ comments.0.author.username }}</h5>
                                <p>{{ comments.0.content }}</p>
                                <small class="text-muted">Posted on {{ comments.0.created_at }}</small>
                            </div>
                        </div>
                        <!-- Arrow to load more comments -->
                        <button class="btn btn-link" onclick="toggleComments()">
                            <i class="fas fa-chevron-down"></i> Load more comments
                        </button>
                        <!-- Hidden comments -->
                        <div id="comments" style="display: none;">
                            {% for comment in comments|slice:"1:" %}
                                <div class="media mb-3">
                                    {% if comment.author.profile_pic %}
                                        <!-- Display user profile picture if available -->
                                        <img class="mr-3" src="{{ comment.author.profile_pic.url }}" alt="{{ comment.author.username }}" style="width: 64px; height: 64px; border-radius: 50%;">
                                    {% else %}
                                        <!-- Display Font Awesome user icon if no profile picture -->
                                        <i class="fas fa-user-circle fa-3x mr-3"></i>
                                    {% endif %}
                                    <div class="media-body">
                                        <h5 class="mt-0">{{ comment.author.username }}</h5>
                                        <p>{{ comment.content }}</p>
                                        <small class="text-muted">Posted on {{ comment.created_at }}</small>
                                    </div>
                                </div>
                            {% empty %}
                                <p>No more comments.</p>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p>No comments yet. Be the first to comment!</p>
                    {% endif %}

                    <!-- Comment Form -->
                    {% if user.is_authenticated %}
                        <form method="post">
                            {% csrf_token %}
                            <div class="form-group">
                                <textarea class="form-control" rows="3" name="content" placeholder="Add a comment..."></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Post Comment</button>
                        </form>
                    {% else %}
                        <p>You must be logged in to post a comment.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleComments() {
        var commentsDiv = document.getElementById('comments');
        var button = commentsDiv.previousElementSibling;
        if (commentsDiv.style.display === 'none') {
            commentsDiv.style.display = 'block';
            button.innerHTML = '<i class="fas fa-chevron-up"></i> Hide comments';
        } else {
            commentsDiv.style.display = 'none';
            button.innerHTML = '<i class="fas fa-chevron-down"></i> Load more comments';
        }
    }
</script>
{% endblock %}
